<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="__PUBLIC_IMG__/3.ico"/>
    <title>Automation Test System | Starter</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="__PUBLIC_CSS__/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/font-awesome/css/font-awesome.min.css">
    <!--<link rel="stylesheet" href="__PUBLIC_CSS__/font-awesome/css/fontawesome-all.css">-->
    <!-- Ionicons -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/Ionicons/ionicons.min.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/select2/select2.min.css">
    <!--PACE-->
    <link rel="stylesheet" href="__PUBLIC_CSS__/pace/pace.css">
    <!--    bootstrap dataTables-->
    <link rel="stylesheet" type="text/css" href="__PUBLIC_CSS__/bootstrap-table-develop/bootstrap-table.min.css">
    <!--    bootstrap dataTables extensions-->
    <link rel="stylesheet" href="__PUBLIC_CSS__/bootstrap-table-develop/extensions/page-jumpto/bootstrap-table-jumpto.css">

    <!-- iCheck for checkboxes and radio inputs -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/iCheck/all.css">
    <!-- Select2 -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/select2/select2.min.css">
    <!--    bootstrapValidator-->
    <link href="__PUBLIC_CSS__/bootstrapValidator/bootstrapValidator.min.css" rel="stylesheet">
    <!-- Theme style -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/AdminLTE/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/skins/skin-purple.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="__PUBLIC_CSS__/html5shiv.min.js"></script>
    <script src="__PUBLIC_CSS__/respond.min.js"></script>
    <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/googleFont.css">
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<!--<body class="hold-transition skin-blue sidebar-mini">-->
<body class="hold-transition skin-purple sidebar-collapse sidebar-mini">
<div class="wrapper">
    {include file="common/header" /}
    <!-- Left side column. contains the logo and sidebar -->
    {include file="common/sidebar" /}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Task Manager
                <small>For Auto Tool</small>
            </h1>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-body">
                            <div id="toolbar" class="btn-toolbar" role="toolbar">
                                <div class="btn-group" role="group" >
                                    <!--                                    <button type="button" class="btn btn-primary btn-sm" id="task"><i class="fa fa-tasks"></i>&nbsp;Task</button>-->
                                    <button type="button" class="btn btn-primary btn-sm" id="task"><i class="glyphicon glyphicon-th-list"></i>&nbsp;Task</button>
                                </div>

                                <div class="btn-group" role="group" style="display: none">
                                    <button type="button" class="btn btn-success btn-sm" id="addTask" data-toggle="modal" data-target="#addModal"><i class="fa fa-plus fa-fw"></i>&nbsp;Add</button>
                                    <button type="button" class="btn btn-warning btn-sm" id="assignTask"><i class="fa fa-wrench fa-fw"></i>&nbsp;Assign</button>
                                    <!--                                    <button type="button" class="btn btn-info btn-sm" id="editTask" data-toggle="modal"><i class="fa fa-edit fa-fw"></i>&nbsp;Edit</button>-->
                                    <button type="button" class="btn btn-danger btn-sm" id="deleteTask"><i class="fa fa-close  fa-fw"></i>&nbsp;Delete</button>
                                    <!--                                    <button type="button" class="btn btn-default btn-sm"><i class="fa fa-copy fa-fw"></i>&nbsp;Copy</button>-->
                                </div>
                                <!--                <button class="btn btn-warning pull-right btn-sm" href="#"><i class="fa fa-sync fa-spin fa-fw" aria-hidden="true"></i></button>-->
                            </div>
                            <table id="taskTable" class="" data-show-jumpto="true"></table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ADD 模态框（Modal） -->
            <div class="modal fade" id="addModal"  role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" >Add Task</h4>
                        </div>
                        <form class="form-horizontal form-group-sm" id="addTaskForm" method="post">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Test Machine</label>
                                    <div class="col-sm-9">
                                        <select class="form-control" name="machine_name">
                                        </select>
                                    </div>
                                </div>
                                <div style="display:none;" data-topic="inputDmiInfo">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Product Name</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="dmi_product_name" >
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Serial Number</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="dmi_serial_number" >
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Part Number</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="dmi_part_number" >
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">OEM String</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="dmi_oem_string" >
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">SystemConfig</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="dmi_system_config">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">BIOS/EC</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="bios_ec" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">LANIP</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="lan_ip" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">ShelfID/SwitchID</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="shelf_switch" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary btn-sm">Submit</button>
                                <!--<button type="reset" class="btn btn-primary btn-sm">reset</button>-->
                                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>
                            </div>
                        </form>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal -->
            <!--        detail info-->
            <div class="modal fade" id="detailInfo"  role="dialog" aria-labelledby="myModalLabel2" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title">Detail Info</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="nav-tabs-custom">
                                    <ul class="nav nav-tabs">
                                        <li class="active"><a href="#tab_1" data-toggle="tab">Tab 1</a></li>
                                        <li><a href="#tab_2" data-toggle="tab">Tab 2</a></li>
                                        <li><a href="#tab_3" data-toggle="tab">Tab 3</a></li>
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                                Dropdown <span class="caret"></span>
                                            </a>
                                            <ul class="dropdown-menu">
                                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Action</a></li>
                                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Another action</a></li>
                                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Something else here</a></li>
                                                <li role="presentation" class="divider"></li>
                                                <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Separated link</a></li>
                                            </ul>
                                        </li>
                                        <li class="pull-right"><a href="#" class="text-muted"><i class="fa fa-gear"></i></a></li>
                                    </ul>
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="tab_1">
                                            <b>How to use:</b>

                                            <p>Exactly like the original bootstrap tabs except you should use
                                                the custom wrapper <code>.nav-tabs-custom</code> to achieve this style.</p>
                                            A wonderful serenity has taken possession of my entire soul,
                                            like these sweet mornings of spring which I enjoy with my whole heart.
                                            I am alone, and feel the charm of existence in this spot,
                                            which was created for the bliss of souls like mine. I am so happy,
                                            my dear friend, so absorbed in the exquisite sense of mere tranquil existence,
                                            that I neglect my talents. I should be incapable of drawing a single stroke
                                            at the present moment; and yet I feel that I never was a greater artist than now.
                                        </div>
                                        <!-- /.tab-pane -->
                                        <div class="tab-pane" id="tab_2">
                                            The European languages are members of the same family. Their separate existence is a myth.
                                            For science, music, sport, etc, Europe uses the same vocabulary. The languages only differ
                                            in their grammar, their pronunciation and their most common words. Everyone realizes why a
                                            new common language would be desirable: one could refuse to pay expensive translators. To
                                            achieve this, it would be necessary to have uniform grammar, pronunciation and more common
                                            words. If several languages coalesce, the grammar of the resulting language is more simple
                                            and regular than that of the individual languages.
                                        </div>
                                        <!-- /.tab-pane -->
                                        <div class="tab-pane" id="tab_3">
                                            Lorem Ipsum is simply dummy text of the printing and typesetting industry.
                                            Lorem Ipsum has been the industry's standard dummy text ever since the 1500s,
                                            when an unknown printer took a galley of type and scrambled it to make a type specimen book.
                                            It has survived not only five centuries, but also the leap into electronic typesetting,
                                            remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset
                                            sheets containing Lorem Ipsum passages, and more recently with desktop publishing software
                                            like Aldus PageMaker including versions of Lorem Ipsum.
                                        </div>
                                        <!-- /.tab-pane -->
                                    </div>
                                    <!-- /.tab-content -->
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">close</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- Main Footer -->
    {include file="common/footer" /}

</div>

<!-- REQUIRED JS SCRIPTS -->

<!-- Bootstrap 3.3.7 -->
<script src="__PUBLIC_JS__/bootstrap/bootstrap.min.js"></script>
<!--PACE-->
<script src="__PUBLIC_JS__/pace/pace.js"></script>
<!--    bootstrap dataTables-->
<script type="text/javascript" src="__PUBLIC_JS__/bootstrap-table-develop/bootstrap-table.min.js"></script>
<script type="text/javascript" src="__PUBLIC_JS__/bootstrap-table-develop/locale/bootstrap-table-en-US.min.js"></script>
<!--    bootstrap dataTables extensions-->
<script src="__PUBLIC_JS__/bootstrap-table-develop/extensions/page-jumpto/bootstrap-table-jumpto.js"></script>

<!-- iCheck 1.0.1 -->
<script src="__PUBLIC_JS__/iCheck/icheck.min.js"></script>
<!-- bootbox4.4 -->
<script src="__PUBLIC_JS__/bootbox4.4/bootbox.min.js"></script>
<!-- Select2 -->
<script src="__PUBLIC_JS__/select2/select2.min.js"></script>
<!--    bootstrapValidator-->
<script src="__PUBLIC_JS__/bootstrapvalidator/bootstrapValidator.min.js"></script>
<!-- AdminLTE App -->
<script src="__PUBLIC_JS__/adminlte/adminlte.min.js"></script>

<script>
    $(function () {

        testMachine = $("select[name='machine_name']");
        inputDmiInfo = $('div[data-topic="inputDmiInfo"]');

        //Task
        taskButton();

        // table
        tableInit(queryParams);

        //Tool Tips 为未来元素
        $('#taskTable').on("mouseenter", "[data-toggle='tooltip']", function(){
            $(this).tooltip('show');
        }).on("mouseleave", "[data-toggle='tooltip']", function(){
            $(this).tooltip('hide');
        });
        // $("[data-toggle='tooltip']").tooltip();

        // select2
        select2Init();

        addFormValidatorInit();

        // assign
        assignButtonInit();

        // delete
        deleteTaskButtonInit();

    });

    function taskButton(){
        var buttonGroup=$('.btn-group:eq(1)');
        var time=null;

        $('.btn-group:eq(0), .btn-group:eq(1)').mouseenter(function () {
            clearTimeout(time);
            buttonGroup.css('display', 'block');
        });

        // Task
        $('.btn-group:eq(0), .btn-group:eq(1)').mouseleave(function () {
            time=setTimeout(function(){
                buttonGroup.css('display', 'none');
            },300);
        });
    };

    function tableInit(queryPs){
        $('#taskTable').bootstrapTable({
            url: "{:url('TaskManager/taskPagination')}",    //请求后台的URL（*）
            method: 'post',                      //请求方式（*）
            classes: 'table table-responsive table-hover table-no-bordered', // table 样式
            iconSize: 'sm',
            buttonsClass: 'warning',
            toolbar: '#toolbar',                //工具按钮用哪个容器
            striped: true,                      //是否显示行间隔色
            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true,                   //是否显示分页（*）
            sortable: true,                     //是否启用排序
            sortOrder: "asc",                   //排序方式
            queryParamsType : "",                   //默认是limit，则para为params.limit, params.offset
            queryParams: queryPs,
            clickToSelect: false,               //点击行即可选中单选/复选框
            sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
            pageNumber:1,                       //初始化加载第一页，默认第一页
            pageSize: 10,                       //每页的记录行数（*）
            pageList: [10, 25, 50],        //可供选择的每页的行数（*）
            search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端
            strictSearch: true,
            showColumns: true,                  //是否显示所有的列
            showRefresh: true,                  //是否显示刷新按钮
            minimumCountColumns: 2,             //最少允许的列数
            // height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "TaskID",                     //每一行的唯一标识，一般为主键列
            showToggle:false,                    //是否显示详细视图和列表视图的切换按钮
            cardView: false,                    //是否显示详细视图
            detailView: false,                   //是否显示父子表
            columns: [{
                checkbox: true
            }, {
                field: 'task_id',
                title: 'TaskID',
                formatter:function(value, row, index){
                    return 'ATS_' + value;
                }
            }, {
                field: 'machine_name',
                title: 'Test Machine',
                formatter:function(value, row, index){
                    return value;
                }
            }, {
                field: 'machine_id',
                title: 'MachineID'
            }, {
                field: 'status',
                title: 'Task Status',
                formatter:function(value, row, index){
                    if (0==value){
                        return "pending";
                    }else if (1==value){
                        return "ongoing";
                    }else if (2==value){
                        return "finished";
                    }else if (3==value){
                        return "Cancelled";
                    }else if (4==value){
                        return "Abnormal End";
                    }else if (5==value){
                        return "expired";
                    }
                    return "N/A";
                }
            }, {
                field: 'task_start_time',
                title: 'Start Time',
            }, {
                field: 'task_end_time',
                title: 'Finish Time'
            },
                {
                field: 'process',
                title: 'Process',
                formatter: function (value, row, index) {

                    if (0 == value) {
                        return '<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 2em; width: 2%">0%</div>';
                    } else {
                        return '<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 2em; width: ' + value + '%">' + value + '%</div>';
                    }

                }
            },
                {
                field: 'result',
                title: 'Test Result',
                formatter: function(value, row, index){
                    var path = "\\\\172.30.52.28\\JSDataBK\\#Temp\\\@ATS_Results\\Task_"+ row['ShelfID'] + "_" + row.SwitchId + "_" + row.TaskID;
                    if("Fail"==value){
                        return '<a href='+ path +'><i class="fa fa-times fa-fw"></i>&nbsp;' + value + '</a>';
                    } else if("Pass"==value){
                        return '<a href='+ path +'><i class="fa fa-check fa-fw"></i>&nbsp;' + value + '</a>';
                    }
                    return "N/A";
                }
            }, {
                field: 'tester',
                title: 'Tester'
            }, {
                field: 'tool',
                title: 'Tool',
                formatter: function (value, row, index) {
                    var result="";
                    result += "<a class='btn btn-xs bg-aqua'  data-toggle=\"tooltip\" data-placement=\"bottom\" title='add' style='margin: 3px'><span class='glyphicon glyphicon-plus'></span></a>";
                    result += "<a class='btn btn-xs bg-green'  data-toggle=\"tooltip\" data-placement=\"bottom\" title='edit' style='margin: 3px'><span class='glyphicon glyphicon-pencil'></span></a>";
                    result += "<a class='btn btn-xs bg-red'  data-toggle=\"tooltip\" data-placement=\"bottom\" title='delete' style='margin: 3px'><span class='glyphicon glyphicon-trash'></span></a>";

                    return result;
                }
                }
            ],
            rowStyle: function(row, index){
                if("Fail"==row.result){
                    return {classes: 'danger'};
                }else if("Pass"==row.result){
                    return {classes: 'success'};
                }else if(0==row.status){
                    return {classes: 'info'};
                }else if(1==row.status){
                    return {classes: 'warning'};
                }
                return {classes: 'active'};
            },

            formatLoadingMessage: function () {
                return '<i class="fa fa-fw fa-spinner fa-pulse fa-2x" style="color:#96B97D"></i>';
            },

            onLoadError: function () {
                toastr.error("Table LoadError!");
            },
            formatNoMatches: function () {  //没有匹配的结果
                return '<i class="text-danger">No matching records found</i>';
            }
        }).on('dbl-click-row.bs.table', function(row, $element, field){
            console.log($element);
            var taskId=$element.TaskID;
            console.log(taskId);
            $.ajax({
                type: "post",
                url: "../functions/atsController.php?do=getAtsInfoByTaskId&" + "taskID=" + taskId,
                dataType: "json",
                success: function (result) {
                    console.log(result.flag);
                    if(result.flag){
                        $("#dmiInfo").find('p:eq(0)').html(result.row['TaskID']);
                        $("#dmiInfo").find('p:eq(1)').html(result.row['DMI_ProductName']);
                        $("#dmiInfo").find('p:eq(2)').html(result.row['DMI_SerialNumber']);
                        $("#dmiInfo").find('p:eq(3)').html(result.row['DMI_PartNumber']);
                        $("#dmiInfo").find('p:eq(4)').html(result.row['DMI_OEMString']);
                        $("#dmiInfo").find('p:eq(5)').html(result.row['DMI_SystemConfig']);
                        $("#dmiInfo").find('p:eq(6)').html(result.row['BIOS_EC']);
                        if (result.row['ExecuteJob']){
                            $("#dmiInfo").find('p:eq(7)').html(result.row['ExecuteJob']);
                            $("#dmiInfo").find('p:eq(8)').html(result.row['run_baseline']);
                        } else {
                            $("#dmiInfo").find('p:eq(7)').html('N/A');
                            $("#dmiInfo").find('p:eq(8)').html('N/A');
                        }

                        $("#dmiInfo").find('p:eq(9)').html(result.row['OSActivation']);
                        $("#dmiInfo").modal("toggle");
                    }
                    else{
                        toastr.info("TaskID = " + taskId + " didn't found! Please Refresh Table!");
                    }
                },
                error:function (xhr,status,error) {
                    toastr.error(xhr.status + " " + xhr.statusText);
                }
            });
        });

    };

    function queryParams(params) {
        var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
            pageSize : params.pageSize,
            pageNumber : params.pageNumber
        };
        return temp;//传递参数（*
    };

    function  select2Init() {

        testMachine.select2({
                width: "100%",
                ajax: {
                    url: "{:url('TaskManager/readMachineInfo')}",
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term // search term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data
                        };
                    },
                    cache: false
                },
                placeholder: 'Please Select',
                allowClear: true
            }
        );

        testMachine.on("select2:select",function(e){

            $('#addTaskForm').data('bootstrapValidator').destroy();
            addFormValidatorInit();

            console.log(testMachine.val());
            var testMachineVal = testMachine.val();
            var machineId = testMachine.select2('data')[0].text;
            if (null != machineId) {
                machineId = machineId.replace(testMachineVal, '');
                machineId = machineId.substring(1, machineId.length - 1);
            }
            console.log(machineId);

            $.ajax({
                type: 'post',
                url: "{:url('TaskManager/readTestPCDetail')}",
                data: {machineId: machineId},
                dataType: 'json',
                success: function(result){
                    inputDmiInfo.css('display', 'block');
                    inputDmiInfo.find('input').each(function (i) {
                        $(this).val(result[i]);
                    });

                },
                error: function () {
                    toastr.error("Machine Info Read Failed");
                }
            });
        });
        testMachine.on("change", function (e) {
            inputDmiInfo.css('display', 'none').find('input').val('');
            $('#addTaskForm').data('bootstrapValidator').destroy();
            addFormValidatorInit();
        });
    }

    function assignButtonInit(){
        $('#assignTask').click( function () {
            var ckArr = $('#taskTable').bootstrapTable('getSelections');
            console.log(ckArr);

            if(ckArr.length == 0){
                toastr.info("Please select at least one checkbox");
                return false;

            } else if(ckArr.length >= 1 && ckArr.length<= 5){
                $.ajax({
                    type: "get",
                    url: "../functions/atsController.php?do=checkAtsInfoByMultiTaskId",
                    data: {multiTask: ckArr},
                    dataType: 'json',
                    success: function (result) {
                        console.log(result.NoTaskIdFlag);
                        console.log(result.NotPendingFlag);

                        if (result.NoTaskIdFlag){
                            toastr.info("TaskID = " + result.saveNoTaskId + " didn't found! Please Refresh Table!");
                            return false;
                        }
                        if (result.NotPendingFlag) {
                            toastr.info("TaskID = " + result.saveNotPending + " not pending! cannnot assign to ATS");
                            return false;
                        }

                        // assign to ATS
                        $.ajax({
                            type: "get",
                            url: "../functions/atsController.php?do=assignAtsInfoByMultiTaskId",
                            data: {multiTask: ckArr},
                            dataType: 'json',
                            success: function (result) {
                                if("done" === result){
                                    toastr.success("success assign to ATS");
                                    $('#taskTable').bootstrapTable('selectPage', 1);
                                } else {
                                    toastr.error(result);
                                }
                            },
                            error: function () {
                                toastr.error("fail assign to ATS");
                            }
                        });
                    },
                    error: function (xhr,status,error) {
                        toastr.error(xhr.status + " " + xhr.statusText);
                    }
                });
            } else {
                toastr.warning("Please select not more than five checkbox");
                return false;
            }

        });
    }


    function deleteTaskButtonInit() {
        $('#deleteTask').click(function () {
            var ckArr = $('#taskTable').bootstrapTable('getSelections');
            console.log(ckArr);
            if(ckArr.length == 0){
                toastr.info("Please select at least one checkbox");
                return false;
            }
            if(ckArr.length >= 1 && ckArr.length<= 5){
                bootbox.confirm({
                    message: " Do you want delete ?",
                    buttons: {
                        confirm: {
                            label: 'Yes',
                            className: 'btn-success'
                        },
                        cancel: {
                            label: 'No',
                            className: 'btn-danger'
                        }
                    },
                    callback: function (result) {
                        if(result){
                            $.ajax({
                                type: "post",
                                url: "../functions/atsController.php?do=checkAtsInfoByMultiTaskId",
                                data: {multiTask: ckArr},
                                dataType: 'json',
                                success: function (result2) {
                                    console.log(result2.NoTaskIdFlag);
                                    console.log(result2.NotPendingFlag);
                                    if (result2.NoTaskIdFlag){
                                        toastr.info("TaskID = " + result2.saveNoTaskId + " didn't found! Please Refresh Table!");
                                        return false;
                                    }
                                    if (result2.NotPendingFlag) {
                                        toastr.info("TaskID = " + result2.saveNotPending + " not pending! cannnot delete");
                                        return false;
                                    }
                                    // delete
                                    $.ajax({
                                        type: "get",
                                        url: "../functions/atsController.php?do=deleteAtsInfoByMultiTaskId",
                                        data: {multiTask: ckArr},
                                        // dataType: 'json',
                                        success: function (result2) {
                                            if("done" == result2){
                                                toastr.success("success deleted");
                                                $('#taskTable').bootstrapTable('selectPage', 1);
                                            } else {
                                                toastr.error(result2);
                                            }
                                        },
                                        error: function () {
                                            toastr.error("fail deleted");
                                        }
                                    });
                                },
                                error: function (xhr,status,error) {
                                    toastr.error(xhr.status + " " + xhr.statusText);
                                }
                            });
                        }
                    }
                });
            } else {
                toastr.warning("Please select not more than five checkbox");
                return false;
            }
        });
    };

    function addFormValidatorInit(){
        $('#addTaskForm').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                machine_name: {
                    message: 'the testMachine is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The testMachine is required and can\'t be empty'
                        }
                    }
                },
                dmi_product_name: {
                    message: 'the Product Name is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The product name is required and can\'t be empty'
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: 'The product name must be more than 5 and less than 20 characters long'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_~! @#$%^&*-/,]+$/,
                            message: 'The product name can only consist of special character like ~!@#$%^&*-/, , number, en.'
                        }

                    }
                },
                dmi_serial_number: {
                    message: 'the sn is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The sn is required and can\'t be empty'
                        },
                        stringLength: {
                            min: 5,
                            max: 20,
                            message: 'The sn must be more than 5 and less than 20 characters long'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_~! @#$%^&*-/,]+$/,
                            message: 'The sn can only consist of special character like ~!@#$%^&*-/, , number, en.'
                        }

                    }
                },
                dmi_part_number: {
                    message: 'the pn is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The pn is required and can\'t be empty'
                        },
                        stringLength: {
                            min: 5,
                            max: 30,
                            message: 'The pn must be more than 5 and less than 30 characters long'
                        },
                        regexp: {
                            regexp: /^[a-zA-Z0-9_~! @#$%^&*-/,]+$/,
                            message: 'The pn can only consist of special character like ~!@#$%^&*-/, , number, en.'
                        }

                    }
                },
                dmi_oem_string: {
                    // enabled: false,
                    message: 'the oem is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The oem is required and can\'t be empty'
                        },
                        stringLength: {
                            min: 5,
                            max: 100,
                            message: 'The oem must be more than 5 and less than 100 characters long'
                        },
                        regexp: {
                            // regexp: /^[a-zA-Z0-9_\. \u4e00-\u9fa5 ]+$/,
                            regexp: /^[a-zA-Z0-9_~! @#$%^&*-/,]+$/,
                            message: 'The oem can only consist of special character like ~!@#$%^&*-/, , number, en.'
                        }

                    }
                },
                dmi_system_config: {
                    // enabled: false,
                    message: 'the sytsem config is not valid',
                    validators: {
                        notEmpty: {
                            message: 'The sytsem config is required and can\'t be empty'
                        },
                        stringLength: {
                            min: 1,
                            max: 20,
                            message: 'The sytsem config must be more than 1 and less than 20 characters long'
                        },
                        regexp: {
                            // regexp: /^[a-zA-Z0-9_\. \u4e00-\u9fa5 ]+$/,
                            regexp: /^[a-zA-Z0-9_~! @#$%^&*-/,]+$/,
                            message: 'The sytsem config can only consist of special character like ~!@#$%^&*-/, , number, en.'
                        }

                    }
                }
            }

        }).on('success.form.bv', function (e) {
            // Prevent form submission
            e.preventDefault();

            // Get the form instance
            var $form = $(e.target);

            // Get the BootstrapValidator instance
            var bv = $form.data('bootstrapValidator');

            var machineId = testMachine.select2('data')[0].text;
            console.log(machineId);
            var testMachineVal = testMachine.val();
            console.log(testMachineVal);
            if (null != machineId) {
                machineId = machineId.replace(testMachineVal, '');
                machineId = machineId.substring(1, machineId.length - 1);
            }

            var formSerialize = $form.serialize() + '&machine_id=' + machineId;

            // Use Ajax to submit form data
            $.ajax({
                type : "post",
                url: "{:url('TaskManager/addTask')}",
                data: {
                    formSerialize
                },
                success : function (result) {
                    console.log(result);
                    if (result == "success") {
                        toastr.success('add success!');

                    }
                },
                error : function(xhr,status,error){
                    toastr.error('add fail! try again ');
                },
                complete : function () {
                    // setTimeout("window.location.href=\"TaskManager\"",3000);

                }
            });
        });

    };
</script>

</body>
</html>