<!DOCTYPE html>
<html>
<head>
    {include file="render/render_css" /}
    {include file="render/theme_css" /}

</head>
<body class="{$Think.const.THEME}">
<div class="wrapper">
    {include file="common/header" /}
    <!-- Left side column. contains the logo and sidebar -->
    {// include file="common/sidebar" /}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                ATS
                <small>DashBoard</small>
            </h1>
            <!--<ol class="breadcrumb">-->
                <!--<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>-->
                <!--<li><a href="#">Charts</a></li>-->
                <!--<li class="active">Flot</li>-->
            <!--</ol>-->
        </section>

        <!-- Main content -->
        <section class="content">

            <div class="row">
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="fa fa-paper-plane"></i></span>
                        <div class="info-box-content" id="pending">
                            <span class="info-box-text">Pending</span>
                            <span class="info-box-number"></span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-md-3 col-sm-6 col-xs-12" >
                    <div class="info-box">
                        <span class="info-box-icon bg-blue"><i class="fa fa-cog"></i></span>
                        <div class="info-box-content" id="ongoing">
                            <span class="info-box-text">Ongoing</span>
                            <span class="info-box-number"></span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->

                <!-- fix for small devices only -->
                <div class="clearfix visible-sm-block"></div>

                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-green"><i class="fa fa-hourglass"></i></span>
                        <div class="info-box-content" id="finished">
                            <span class="info-box-text">Finished</span>
                            <span class="info-box-number"></span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-gray"><i class="fa fa-warning" style="color: white"></i></span>
                        <div class="info-box-content" id="expired">
                            <span class="info-box-text">Expired</span>
                            <span class="info-box-number"></span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
            </div>

            <!--<div class="callout callout-info">-->
                <!--<h4>The following was created using data tags</h4>-->

                <!--<p>The following three inline (sparkline) chart have been initialized to read and interpret data tags</p>-->
            <!--</div>-->
            <div class="row">
                <div class="col-md-12">
                    <!-- Line chart -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">Statistical Testing Machine <small id="machineHeader" class="label bg-blue text-sm"></small></h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="machineChartCreate('hour')">Hour Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="machineChart" style="height: 300px;"></div>
                            <!--<div class="well text-blue" style="height: 100%;display: none"><i class="fa fa-search" style="margin-top: 10%;margin-left: 40%"> Machine Chart No Data Init</i></div>-->
                        </div>
                        <!-- /.box-body-->
                    </div>
                    <!-- /.box -->
                </div>
                <!-- /.col -->
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">Statistical Tool Results <small id="statusHeader" class="label bg-blue text-sm"></small></h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="statusChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="statusChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="statusChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="statusChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="statusChart" style="height: 400px;width: 100%" ></div>
                        </div>
                        <!-- /.box-body-->
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">Statistical Task Results <small id="resultHeader" class="label bg-blue text-sm"></small></h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="resultChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="resultChart" style="height: 400px;width: 100%" ></div>
                        </div>
                    </div>

                </div>

                <div class="col-md-6">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">Statistics Tasks Added By Testers <small id="testerHeader" class="label bg-blue text-sm"></small></h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="testerChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="testerChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="testerChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="testerChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <!--<button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>-->
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="testerChart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- /.content-wrapper -->
    {include file="common/footer" /}

</div>
<!-- ./wrapper -->

{include file="render/render_js" /}

<!--echarts-->
<script src="__PUBLIC_JS__/echarts/echarts.min.js"></script>
<!-- 引入 vintage 主题 -->
<script src="__PUBLIC_JS__/echarts/themes/roma.js"></script>
<script>

    $(function () {
        // tooltip init
        // $("[data-toggle='tooltip']").tooltip();

        machine_chart = echarts.init(document.getElementById('machineChart'));
        status_chart = echarts.init(document.getElementById('statusChart'));
        result_chart = echarts.init(document.getElementById('resultChart'));
        tester_chart = echarts.init(document.getElementById('testerChart'), 'roma');

        myTaskInit();
        machineChartCreate(Week);
        statusChartCreate(Week);
        resultChartCreate(Week);
        testerChartCreate(Week);

        $(window).resize(function(){
            machine_chart.resize();
            status_chart.resize();
            result_chart.resize();
            tester_chart.resize();
        });
    });

    function myTaskInit() {
        $.ajax({
            type : "post",
            url: "{:url('DashBoard/myTaskInit')}",
            success: function (result) {
                result = JSON.parse(result);
                $('#pending').find('span:eq(1)').text(result.pending);
                $('#ongoing').find('span:eq(1)').text(result.ongoing);
                $('#finished').find('span:eq(1)').text(result.finished);
                $('#expired').find('span:eq(1)').text(result.expired);
            },
            error: function () {
                toastr.error('Get My Task Fail');
            }

        })


    }

    function machineChartCreate(timers) {
        if (Day === timers) {
            $('#machineHeader').html(getHeader(Month));
        } else if (Month === timers) {
            $('#machineHeader').html(getHeader(Year));
        } else if (Year === timers) {
            $('#machineHeader').html('');
        } else {
            $('#machineHeader').html(getHeader(timers));
        }

        // machine and result chart init
        machine_chart.showLoading();

        $.ajax({
            type : "post",
            url: "{:url('DashBoard/machineChart')}",
            data: {
                timer: timers
            },
            success : function (result) {
                var item;
                var series = [];
                var xAxis = [];

                result = JSON.parse(result);

                if (Year === timers) {
                    xAxis = result.xAxis;
                    // console.log(xAxis);
                } else {
                    xAxis = createTimerArray(timers);
                }

                // console.log(result.seriesData);
                if (!isNull(result)) {
                    item = result.seriesName;
                    for (var i = 0; i < item.length; i++) {
                        series.push({
                            name:item[i],
                            type:'bar',
                            data:result.seriesData[i],
                            // 最大最小的名字
                            markPoint : {
                                data : [
                                    {type : 'max', name: 'Max'},
                                    {type : 'min', name: 'Min'}
                                ]
                            },
                            itemStyle: {
                                normal: {
                                    lineStyle: {
                                        shadowColor : 'rgba(0,0,0,0.3)',
                                        shadowBlur: 10,
                                        shadowOffsetX: 8,
                                        shadowOffsetY: 8
                                    }
                                }
                            }
                        });

                    }
                    // console.log(series);
                    machine_chart.hideLoading();
                    // 使用刚指定的配置项和数据显示图表。
                    machine_chart.setOption({
                        tooltip : {
                            trigger: 'axis'
                        },
                        legend: {
                            data: item
                        },
                        color: ["#55ce63", "#009efb"],
                        toolbox: {
                            // orient: 'vertical',
                            right: 20,
                            show : true,
                            feature : {
                                dataView: { //数据视图
                                    show: true,
                                    readOnly: true,
                                    // title: 'dataView'
                                },
                                magicType : {show: true, type: ['line', 'bar']},
                                restore : {show: true},
                                saveAsImage : {show: true}
                            }
                        },
                        xAxis: {
                            type : 'category',
                            boundaryGap : true, //坐标轴两边留白策略
                            data : xAxis
                        },
                        yAxis: [
                            {
                                type: 'value',
                                minInterval: 1
                            }
                        ],
                        series: series
                    }, true);

                } else {
                    setChartTitle(machine_chart, 'No Data');
                }

            },
            error : function(xhr,status,error){
                setChartTitle(machine_chart, 'Init Error');
            }

        });
    }

    function statusChartCreate(timers) {

        $('#statusHeader').html(getHeader(timers));

        status_chart.showLoading();

        $.ajax({
            type: "post",
            url: "{:url('DashBoard/statusChart')}",
            data: {
                timer: timers
            },
            success: function (result) {
                var series = [];

                if ("No Data" !== result) {
                    result = JSON.parse(result);
                    for (var i = 0; i < result.length; i++) {
                        series.push({
                            name:result[i].status,
                            type:'bar',
                            stack: '总量', // 堆叠
                            label: {
                                normal: {
                                    show: true,
                                    position: 'inside'
                                }
                            },
                            data:result[i].toolData
                        });
                    }
                    status_chart.hideLoading();
                    status_chart.setOption({
                        tooltip : {
                            trigger: 'axis',
                            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                            }
                        },
                        toolbox: {
                            // orient: 'vertical',
                            right: 15,
                            show : true,
                            feature : {
                                dataView: { //数据视图
                                    show: true,
                                    readOnly: true,
                                    // title: 'dataView'
                                },
                                magicType : {show: true, type: ['bar']},
                                restore : {show: true},
                                saveAsImage : {show: true}
                            }
                        },
                        legend: {
                            data: [Pending, Ongoing, Fail, Pass, Expired]
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis: [
                            {
                                type: 'value',
                                minInterval: 1
                            }
                        ],
                        yAxis: {
                            type: 'category',
                            data: [JumpStart, Recovery, C_Test, Treboot]
                        },
                        series: series
                    }, true);
                } else {
                    setChartTitle(status_chart, 'No Data');
                }

            },
            error: function () {
                setChartTitle(status_chart, 'Init Error');
            }
        });

    }

    function resultChartCreate(timers) {

        $('#resultHeader').html(getHeader(timers));

        result_chart.showLoading();
        $.ajax({
            type: "post",
            url: "{:url('DashBoard/resultChart')}",
            data: {
                timer: timers
            },
            success: function (result) {
                var series = [];
                if ("No Data" !== result) {
                    result = JSON.parse(result);
                    series.push({
                        name:'Area mode',
                        type:'pie',
                        radius : [30, 110],
                        center : ['75%', 200],
                        roseType : 'area',
                        x: '50%',
                        max: 40,
                        sort : 'ascending',
                        data: result
                    });
                    series.push({
                        name:'Radius mode',
                        type:'pie',
                        radius : [20, 110],
                        center : ['25%', 200],
                        roseType : 'radius',
                        width: '40%',       // for funnel
                        max: 40,            // for funnel
                        itemStyle : {
                            normal : {
                                label : {
                                    show : false
                                },
                                labelLine : {
                                    show : false
                                }
                            },
                            emphasis : {
                                label : {
                                    show : true
                                },
                                labelLine : {
                                    show : true
                                }
                            }
                        },
                        data: result
                    });

                    result_chart.hideLoading();

                    result_chart.setOption({
                        tooltip : {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            x : 'center',
                            y : 'bottom',
                            data: [Pending, Ongoing, Fail, Pass, Expired]
                        },
                        toolbox: {
                            right: 20,
                            show : true,
                            feature : {
                                dataView : {show: true, readOnly: true},
                                magicType : {
                                    show: true,
                                    type: ['pie', 'funnel']
                                },
                                restore : {show: true},
                                saveAsImage : {show: true}
                            }
                        },
                        color: ["#ffbc34","#f62d51", "#7460ee","#55ce63", "#009efb", "#dddddd"],
                        calculable : true,
                        series : series

                    }, true);
                } else {
                    setChartTitle(result_chart, 'No Data');
                }
            },
            error: function () {
                setChartTitle(result_chart, 'Init Error');
            }
        });
    }

    function testerChartCreate(timers) {

        $('#testerHeader').html(getHeader(timers));

        tester_chart.showLoading();
        $.ajax({
            type: "post",
            url: "{:url('DashBoard/testerChart')}",
            data: {
                timer: timers
            },
            success: function (result) {
                if ("No Data" !== result) {
                    result = JSON.parse(result);
                    tester_chart.hideLoading();
                    tester_chart.setOption({
                        // title : {
                        //     text: '同名数量统计',
                        //     subtext: '纯属虚构',
                        //     x:'center'
                        // },
                        tooltip : {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            type: 'scroll',
                            orient: 'vertical',
                            right: 10,
                            top: 20,
                            bottom: 20,
                            data: result.legendData,
                            selected: result.selectedData
                        },
                        series : [
                            {
                                name: 'Name',
                                type: 'pie',
                                radius : '55%',
                                center: ['40%', '50%'],
                                data: result.seriesData,
                                itemStyle: {
                                    emphasis: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                }
                            }
                        ]
                    }, true);


                } else {
                    setChartTitle(tester_chart, 'No Data');
                }

            },
            error: function () {
                setChartTitle(tester_chart, 'Init Error');
            }
        });

    }
    
    function createTimerArray(timers) {
        timer = [];
        if (Hour === timers) {
            for (var i = 0; i < 24; i++) {
                timer[i] = i + ':00';
            }

        } else if (Week === timers) {
            timer = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        } else if (Day === timers) {
            var days = getDaysOfMonth();
            for (var i = 0; i < days; i++) {
                timer[i] = i + 1;
            }

        } else if (Month === timers) {
            timer = ['Jan','Feb','Mar','Apr','May','Jun','July','Aug','Sept','Oct','Nov','Dec']

        }

        return timer;
    }

    function setChartTitle(obj, string) {
        obj.hideLoading();
        obj.setOption({
            title : {
                text: string,
                x:'center'
            }
        }, true);
    }


</script>
</body>
</html>
