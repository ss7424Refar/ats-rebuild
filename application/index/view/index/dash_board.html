<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" href="__PUBLIC_IMG__/3.ico"/>
    <title>Automation Test System | Starter</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="__PUBLIC_CSS__/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/font-awesome/css/font-awesome.min.css">
    <!--<link rel="stylesheet" href="__PUBLIC_CSS__/font-awesome/css/fontawesome-all.css">-->
    <!--PACE-->
    <link rel="stylesheet" href="__PUBLIC_CSS__/pace/pace.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/AdminLTE/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/skins/skin-purple.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="__PUBLIC_CSS__/html5shiv.min.js"></script>
    <script src="__PUBLIC_CSS__/respond.min.js"></script>
    <![endif]-->

    <!-- Google Font -->
    <link rel="stylesheet" href="__PUBLIC_CSS__/googleFont.css">
</head>
<body class="hold-transition skin-purple sidebar-collapse sidebar-mini">
<div class="wrapper">
    {include file="common/header" /}
    <!-- Left side column. contains the logo and sidebar -->
    {include file="common/sidebar" /}

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                ATS
                <small>DashBoard</small>
            </h1>
            <!--<ol class="breadcrumb">-->
                <!--<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>-->
                <!--<li><a href="#">Charts</a></li>-->
                <!--<li class="active">Flot</li>-->
            <!--</ol>-->
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-aqua"><i class="fa fa-paper-plane"></i></span>

                        <div class="info-box-content" id="pending">
                            <span class="info-box-text">Pending</span>
                            <span class="info-box-number">90<small>%</small></span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-md-3 col-sm-6 col-xs-12" >
                    <div class="info-box">
                        <span class="info-box-icon bg-blue"><i class="fa fa-cog"></i></span>

                        <div class="info-box-content" id="ongoing">
                            <span class="info-box-text">Ongoing</span>
                            <span class="info-box-number">41,410</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->

                <!-- fix for small devices only -->
                <div class="clearfix visible-sm-block"></div>

                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-green"><i class="fa fa-hourglass"></i></span>
                        <div class="info-box-content" id="finished">
                            <span class="info-box-text">Finished</span>
                            <span class="info-box-number">760</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
                <div class="col-md-3 col-sm-6 col-xs-12">
                    <div class="info-box">
                        <span class="info-box-icon bg-gray"><i class="fa fa-warning" style="color: white"></i></span>

                        <div class="info-box-content" id="expired">
                            <span class="info-box-text">Expired</span>
                            <span class="info-box-number">2,000</span>
                        </div>
                        <!-- /.info-box-content -->
                    </div>
                    <!-- /.info-box -->
                </div>
                <!-- /.col -->
            </div>

            <div class="row">
                <div class="col-md-6">
                    <!-- Line chart -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">测试机型的统计</h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="machineChartCreate('hour')">Hour Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="machineChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="machineChart" style="height: 300px;"></div>
                        </div>
                        <!-- /.box-body-->
                    </div>
                    <!-- /.box -->
                </div>
                <!-- /.col -->

                <div class="col-md-6">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">测试工具结果的统计</h3>

                            <div class="box-tools pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-box-tool dropdown-toggle" data-toggle="dropdown">
                                        <i class="fa fa-calendar"></i></button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#" onclick="resultChartCreate('day')">Day Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('week')">Week Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('month')">Month Unit</a></li>
                                        <li><a href="#" onclick="resultChartCreate('year')">Year Unit</a></li>
                                    </ul>
                                </div>
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="resultChart" style="height: 300px;width: 100%" ></div>
                        </div>
                        <!-- /.box-body-->
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">每周pass,failed等结果的统计</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="area-chart" style="height: 400px;width: 100%" ></div>
                        </div>
                    </div>

                </div>

                <div class="col-md-6">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <i class="fa fa-bar-chart-o"></i>

                            <h3 class="box-title">测试人员添加task数量的统计</h3>

                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                                </button>
                                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                            </div>
                        </div>
                        <div class="box-body">
                            <div id="donut-chart" style="height: 400px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- /.content-wrapper -->
    {include file="common/footer" /}

</div>
<!-- ./wrapper -->

<!-- Bootstrap 3.3.7 -->
<script src="__PUBLIC_JS__/bootstrap/bootstrap.min.js"></script>
<!-- jQuery Knob -->
<!--<script src="__PUBLIC_JS__/jquery-knob/jquery.knob.js"></script>-->
<!--echarts-->
<script src="__PUBLIC_JS__/echarts/echarts.min.js"></script>
<!-- 引入 vintage 主题 -->
<script src="__PUBLIC_JS__/echarts/themes/macarons.js"></script>
<!-- AdminLTE App -->
<script src="__PUBLIC_JS__/adminlte/adminlte.min.js"></script>
<script>

    $(function () {
        // tooltip init
        // $("[data-toggle='tooltip']").tooltip();


        machine_chart = echarts.init(document.getElementById('machineChart'), 'macarons');

        result_chart = echarts.init(document.getElementById('resultChart'), 'macarons');

        machineChartCreate('hour');
        resultChartCreate('day');

        setTimeout(function (){
            window.onresize = function () {
                machine_chart.resize();
                result_chart.resize();
                // barChart.resize();
                areaChart.resize();
                donutChart.resize();
            }
        },200);
    });

    function machineChartCreate(timers) {
        // machine and result chart init
        machine_chart.showLoading();

        $.ajax({
            type : "post",
            url: "{:url('DashBoard/machineChart')}",
            data: {
                timer: timers
            },
            success : function (result) {
                var item;
                var series = [];
                var xAxis = [];

                result = JSON.parse(result);

                if ('year' === timers) {
                    xAxis = result.xAxis;
                    console.log(xAxis);
                } else {
                    xAxis = createTimerArray(timers);
                }

                console.log(result.seriesData);
                if (null !== result && undefined !== result && 0 !== result.length) {
                    item = result.seriesName;
                    for (var i = 0; i < item.length; i++) {
                        series.push({
                            name:item[i],
                            type:'bar',
                            data:result.seriesData[i],
                            // 最大最小的名字
                            markPoint : {
                                data : [
                                    {type : 'max', name: 'Max'},
                                    {type : 'min', name: 'Min'}
                                ]
                            },
                            itemStyle: {
                                normal: {
                                    lineStyle: {
                                        shadowColor : 'rgba(0,0,0,0.3)',
                                        shadowBlur: 10,
                                        shadowOffsetX: 8,
                                        shadowOffsetY: 8
                                    }
                                }
                            }
                        });

                    }
                    // console.log(series);
                    machine_chart.hideLoading();

                    // 使用刚指定的配置项和数据显示图表。
                    machine_chart.setOption({
                        tooltip : {
                            trigger: 'axis'
                        },
                        legend: {
                            data: item
                        },
                        color: ["#55ce63", "#009efb"],
                        toolbox: {
                            show : true,
                            feature : {
                                magicType : {show: true, type: ['line', 'bar']},
                                restore : {show: true},
                                saveAsImage : {show: true}
                            }
                        },
                        xAxis: {
                            type : 'category',
                            boundaryGap : true, //坐标轴两边留白策略
                            data : xAxis
                        },
                        yAxis: {type : 'value'},
                        series: series
                    }, true);

                } else {
                    // $('#machineChart').html('<div class="well text-blue" style="height: 100%"><i class="fa fa-search" style="margin-top: 10%;margin-left: 40%"> Machine Chart No Data Init</i></div>');
                }

            },
            error : function(xhr,status,error){
                // $('#machineChart').html('<div class="well text-blue" style="height: 100%"><i class="fa fa-search" style="margin-top: 10%;margin-left: 40%"> Machine Chart Init Failed</i></div>');
            }

        });
    }

    function resultChartCreate(timers) {
        result_chart.showLoading();

        $.ajax({
            type: "post",
            url: "{:url('DashBoard/resultChart')}",
            data: {
                timer: timers
            },
            success: function (result) {
                var series = [];

                result = JSON.parse(result);
                if (null !== result && undefined !== result && 0 !== result.length) {
                    for (var i = 0; i < result.length; i++) {
                        console.log(result[i].status);
                        series.push({
                            name:result[i].status,
                            type:'bar',
                            stack: '111', // 堆叠
                            label: {
                                normal: {
                                    show: true,
                                    position: 'insideRight'
                                }
                            },
                            data:result[i].toolData
                        });
                        console.log(series);
                    }
                    result_chart.hideLoading();
                    // console.log(series);
                    result_chart.setOption({
                        tooltip : {
                            trigger: 'axis',
                            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                            }
                        },
                        legend: {
                            data: ['ongoing', 'pending', 'fail', 'pass', 'expired']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        xAxis:  {
                            type: 'value'
                        },
                        yAxis: {
                            type: 'category',
                            data: ['JumpStart','Recovery','C-Test']
                        },
                        series: series
                    }, true);
                }

            },
            error: function () {

            }
        });

    }

    function createTimerArray(timers) {
        timer = [];
        if ('hour' == timers) {
            for (var i = 0; i < 24; i++) {
                timer[i] = i + ':00';
            }

        } else if ('week' == timers) {
            timer = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        } else if ('day' == timers) {
            var days = getDaysOfMonth();
            for (var i = 0; i < days; i++) {
                timer[i] = i + 1;
            }

        } else if ('month' == timers) {
            timer = ['Jan','Feb','Mar','Apr','May','Jun','July','Aug','Sept','Oct','Nov','Dec']

        }

        return timer;
    }

    function getDaysOfMonth() {
        var now = new Date();
        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var days = (new Date(year, month, 0)).getDate();
        return days;
    }


    var lineChart = echarts.init(document.getElementById('line-chart'));

    option = {

        tooltip : {
            trigger: 'axis'
        },
        legend: {
            data:['max temp','min temp']
        },
        toolbox: {
            show : true,
            feature : {
                magicType : {show: true, type: ['line', 'bar']},
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        color: ["#55ce63", "#009efb"],
        calculable : true,
        xAxis : [
            {
                type : 'category',
                boundaryGap : false,
                data : ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']
            }
        ],
        yAxis : [
            {
                type : 'value',
                axisLabel : {
                    formatter: '{value} °C'
                }
            }
        ],

        series : [
            {
                name:'max temp',
                type:'line',
                color:['#000'],
                data:[11, 11, 15, 13, 12, 13, 10],
                //
                markPoint : {
                    data : [
                        {type : 'max', name: 'Max'},
                        {type : 'min', name: 'Min'}
                    ]
                },
                itemStyle: {
                    normal: {
                        lineStyle: {
                            shadowColor : 'rgba(0,0,0,0.3)',
                            shadowBlur: 10,
                            shadowOffsetX: 8,
                            shadowOffsetY: 8
                        }
                    }
                },
                // 平均值
                markLine : {
                    data : [
                        {type : 'average', name: 'Average'}
                    ]
                }
            },
            {
                name:'min temp',
                type:'line',
                data:[1, -2, 2, 5, 3, 2, 0],
                markPoint : {
                    data : [
                        {name : 'Week minimum', value : -2, xAxis: 1, yAxis: -1.5}
                    ]
                },
                itemStyle: {
                    normal: {
                        lineStyle: {
                            shadowColor : 'rgba(0,0,0,0.3)',
                            shadowBlur: 10,
                            shadowOffsetX: 8,
                            shadowOffsetY: 8
                        }
                    }
                },
                markLine : {
                    data : [
                        {type : 'average', name : 'Average'}
                    ]
                }
            }
        ]
    };

    lineChart.setOption(option);

    var barChart = echarts.init(document.getElementById('bar-chart'));
    option = {
        tooltip : {
            trigger: 'axis'
        },
        legend: {
            data:['Site A','Site B']
        },
        toolbox: {
            show : true,
            feature : {

                magicType : {show: true, type: ['line', 'bar']},
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        color: ["#55ce63", "#009efb"],
        calculable : true,
        xAxis : [
            {
                type : 'category',
                data : ['Jan','Feb','Mar','Apr','May','Jun','July','Aug','Sept','Oct','Nov','Dec']
            }
        ],
        yAxis : [
            {
                type : 'value'
            }
        ],
        series : [
            {
                name:'Site A',
                type:'bar',
                data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3],
                markPoint : {
                    data : [
                        {type : 'max', name: 'Max'},
                        {type : 'min', name: 'Min'}
                    ]
                },
                markLine : {
                    data : [
                        {type : 'average', name: 'Average'}
                    ]
                }
            },
            {
                name:'Site B',
                type:'bar',
                data:[2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 175.6, 182.2, 48.7, 18.8, 6.0, 2.3],
                markPoint : {
                    data : [
                        {name : 'The highest year', value : 182.2, xAxis: 7, yAxis: 183, symbolSize:18},
                        {name : 'Year minimum', value : 2.3, xAxis: 11, yAxis: 3}
                    ]
                },
                markLine : {
                    data : [
                        {type : 'average', name : 'Average'}
                    ]
                }
            }
        ]
    };

    barChart.setOption(option);

    var areaChart = echarts.init(document.getElementById('area-chart'));

    option = {

        tooltip : {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        legend: {
            x : 'center',
            y : 'bottom',
            data:['rose1','rose2','rose3','rose4','rose5','rose6','rose7','rose8']
        },
        toolbox: {
            show : true,
            feature : {

                dataView : {show: true, readOnly: false},
                magicType : {
                    show: true,
                    type: ['pie', 'funnel']
                },
                restore : {show: true},
                saveAsImage : {show: true}
            }
        },
        // color: ["#f62d51", "#dddddd","#ffbc34", "#7460ee","#009efb", "#2f3d4a","#90a4ae", "#55ce63"],
        calculable : true,
        series : [
            {
                name:'Radius mode',
                type:'pie',
                radius : [20, 110],
                center : ['25%', 200],
                roseType : 'radius',
                width: '40%',       // for funnel
                max: 40,            // for funnel
                itemStyle : {
                    normal : {
                        label : {
                            show : false
                        },
                        labelLine : {
                            show : false
                        }
                    },
                    emphasis : {
                        label : {
                            show : true
                        },
                        labelLine : {
                            show : true
                        }
                    }
                },
                data:[
                    {value:10, name:'rose1'},
                    {value:5, name:'rose2'},
                    {value:15, name:'rose3'},
                    {value:25, name:'rose4'},
                    {value:20, name:'rose5'},
                    {value:35, name:'rose6'},
                    {value:30, name:'rose7'},
                    {value:40, name:'rose8'}
                ]
            },
            {
                name:'Area mode',
                type:'pie',
                radius : [30, 110],
                center : ['75%', 200],
                roseType : 'area',
                x: '50%',               // for funnel
                max: 40,                // for funnel
                sort : 'ascending',     // for funnel
                data:[
                    {value:10, name:'rose1'},
                    {value:5, name:'rose2'},
                    {value:15, name:'rose3'},
                    {value:25, name:'rose4'},
                    {value:20, name:'rose5'},
                    {value:35, name:'rose6'},
                    {value:30, name:'rose7'},
                    {value:40, name:'rose8'}
                ]
            }
        ]
    };

    areaChart.setOption(option);

    var donutChart = echarts.init(document.getElementById('donut-chart'));

    var data = genData(50);

    option = {
        title : {
            text: '同名数量统计',
            subtext: '纯属虚构',
            x:'center'
        },
        tooltip : {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        legend: {
            type: 'scroll',
            orient: 'vertical',
            right: 10,
            top: 20,
            bottom: 20,
            data: data.legendData,

            selected: data.selected
        },
        series : [
            {
                name: '姓名',
                type: 'pie',
                radius : '55%',
                center: ['40%', '50%'],
                data: data.seriesData,
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
        ]
    };




    function genData(count) {
        var nameList = [
            '赵', '钱', '孙', '李', '周', '吴', '郑', '王', '冯', '陈', '褚', '卫', '蒋', '沈', '韩', '杨', '朱', '秦', '尤', '许', '何', '吕', '施', '张', '孔', '曹', '严', '华', '金', '魏', '陶', '姜', '戚', '谢', '邹', '喻', '柏', '水', '窦', '章', '云', '苏', '潘', '葛', '奚', '范', '彭', '郎', '鲁', '韦', '昌', '马', '苗', '凤', '花', '方', '俞', '任', '袁', '柳', '酆', '鲍', '史', '唐', '费', '廉', '岑', '薛', '雷', '贺', '倪', '汤', '滕', '殷', '罗', '毕', '郝', '邬', '安', '常', '乐', '于', '时', '傅', '皮', '卞', '齐', '康', '伍', '余', '元', '卜', '顾', '孟', '平', '黄', '和', '穆', '萧', '尹', '姚', '邵', '湛', '汪', '祁', '毛', '禹', '狄', '米', '贝', '明', '臧', '计', '伏', '成', '戴', '谈', '宋', '茅', '庞', '熊', '纪', '舒', '屈', '项', '祝', '董', '梁', '杜', '阮', '蓝', '闵', '席', '季', '麻', '强', '贾', '路', '娄', '危'
        ];
        var legendData = [];
        var seriesData = [];
        var selected = {};
        for (var i = 0; i < 50; i++) {
            name = Math.random() > 0.65
                ? makeWord(4, 1) + '·' + makeWord(3, 0)
                : makeWord(2, 1);
            legendData.push(name);
            seriesData.push({
                name: name,
                value: Math.round(Math.random() * 100000)
            });
            selected[name] = i < 6;
        }

        return {
            legendData: legendData,
            seriesData: seriesData,
            selected: selected
        };

        function makeWord(max, min) {
            var nameLen = Math.ceil(Math.random() * max + min);
            var name = [];
            for (var i = 0; i < nameLen; i++) {
                name.push(nameList[Math.round(Math.random() * nameList.length - 1)]);
            }
            return name.join('');
        }
    }

    donutChart.setOption(option);

</script>
</body>
</html>
